var dicts = dicts || {};
dicts["de"] = {"":{"project-id-version":"","pot-creation-date":"","po-revision-date":"","last-translator":"","language-team":"","language":"de","mime-version":"1.0","content-type":"text/plain; charset=UTF-8","content-transfer-encoding":"8bit","x-generator":"Poedit 2.0.6","plural-forms":"nplurals=2; plural=(n != 1);"},"This radio has no any artist for the moment.":[null,"Dieses Radio hat zur Zeit noch keinen Interpreten."],"Discover":[null,"Entdecken"],"on RadioKing":[null,"auf RadioKing"],"The field must contains between 4 and 60 characters":[null,"Das Feld muss zwischen 4 und 60 Zeichen enthalten"],"I'm listening \"{0}\" on {1}":[null,"Ich hأ¶re \"{0}\" auf {1}"],"I'm listening \"{0}\" on {1}, {2}":[null,"Ich hأ¶re \"{0}\" auf {1}, {2}"],"listener":[null,"Hأ¶rer"],"listeners":[null,"Zuhأ¶rer"],"This radio doesn't have any tracks for now.":[null,"Dieses Radio hat bis jetzt noch keine Titel."],"This radio has no any track for the moment.":[null,"Dieses Radio hat zur Zeit noch keine Titel."],"Date":[null,"Datum"],"Hour":[null,"Uhrzeit"],"Title":[null,"Titel"],"Buy":[null,"Kaufen"],"<strong>Right</strong><br><strong>now</strong>":[null,"<strong>Genau</strong><br><strong>jetzt</strong>"],"Open in a pop-up":[null,"In einem Pop-up-Fenster أ¶ffnen"],"Download this track":[null,"Diesen Titel downloaden"],"Download":[null,"Downloaden"],"Share this track":[null,"Dieses Titel teilen"],"Share":[null,"Teilen"],"SHARE THIS TRACK":[null,"DIESEN TITEL TEILEN"],"Share on Facebook":[null,"Auf Facebook teilen"],"Share on Twitter":[null,"Auf Twitter teilen"],"Share on Google Plus":[null,"Auf Google Plus teilen"],"Code to embed":[null,"Einbettungscode"],"Do you like this track?":[null,"Gefأ¤llt Ihnen dieser Titel?"],"Error with player settings":[null,"Fehler bei den Player-Einstellungen"],"The player has been successfully added. Reload the page to see the result.":[null,"Der Player wurde erfolgreich hinzugefأ¼gt. Laden Sie die Seite erneut, um das Ergebnis zu sehen."],"To add your Player to this page, please provide the Player key (found in the Widgets section of your Radio Manager)":[null,"Um Ihren Player auf dieser Seite hinzufأ¼gen zu kأ¶nnen, geben Sie bitte den Player-Schlأ¼ssel ein (Sie finden Ihn im Widget-Bereich Ihres Radio Managers)"],"Your Player code:":[null,"Ihr Player-Code:"],"Shout out":[null,"Rufen Sie es heraus"],"Record":[null,"Aufnehmen"],"Your web browser is not compatible with this widget":[null,"Ihr Browser ist nicht kompatibel mit diesem Widget"],"Send your message!":[null,"Senden Sie Ihre Nachricht!"],"Your microphone is not detected, please press to try again":[null,"Ihr Mikrofon wird nicht erkannt. Bitte drأ¼cken, um es erneut zu versuchen"],"You already sent a message less than 1 hour ago":[null,"Sie haben bereits eine Nachricht vor weniger als einer Stunde versandt"],"You can record up to 30 seconds":[null,"Sie kأ¶nnen bis zu 30 Sekunden aufnehmen"],"Recording in progress":[null,"Aufnahme im Gang"],"Stop":[null,"Halt"],"Your record is ready":[null,"Ihre Aufnahme ist fertig"],"Pause":[null,"Pause"],"Listen":[null,"Anhأ¶ren"],"My name or nickname":[null,"Mein Name oder Nickname"],"Send":[null,"Senden"],"Send in progress...":[null,"Senden im Gang..."],"An error has occured, please try again later":[null,"Ein Fehler ist aufgetreten. Bitte versuchen Sie es spأ¤ter erneut"],"Record again":[null,"Erneut aufnehmen"],"Your message was sent":[null,"Ihre Nachricht wurde verschickt"],"Thank you for your messsage.":[null,"Danke fأ¼r Ihre Nachricht."],"Stay tuned!":[null,"Bleiben Sie dran!"],"Close":[null,"Schlieأںen"],"Oops!":[null,"Uups!"],"It seems that we have not detected any sound in your record":[null,"Wir konnten keinen Ton in Ihrer Aufnahme entdecken"]};
dicts["es"] = {"":{"project-id-version":"","pot-creation-date":"","po-revision-date":"","last-translator":"","language-team":"","language":"es","mime-version":"1.0","content-type":"text/plain; charset=UTF-8","content-transfer-encoding":"8bit","x-generator":"Poedit 2.0.6","plural-forms":"nplurals=2; plural=(n != 1);"},"This radio has no any artist for the moment.":[null,"Esta radio no tiene artistas de momento."],"Discover":[null,"Descubrir"],"on RadioKing":[null,"en RadioKing"],"The field must contains between 4 and 60 characters":[null,"Este campo debe contener entre 4 y 60 caracteres"],"I'm listening \"{0}\" on {1}":[null,"Estoy escuchando a \"{0}\" en {1}"],"I'm listening \"{0}\" on {1}, {2}":[null,"Estoy escuchando a \"{0}\" en {1}, {2}"],"listener":[null,"oyente"],"listeners":[null,"oyentes"],"This radio doesn't have any tracks for now.":[null,"Esta radio no tiene ninguna pista por ahora."],"This radio has no any track for the moment.":[null,"Esta radio no tiene ninguna pista de momento."],"Date":[null,"Fecha"],"Hour":[null,"Hora"],"Title":[null,"Tأ­tulo"],"Buy":[null,"Comprar"],"<strong>Right</strong><br><strong>now</strong>":[null,"<strong>Ahora</strong><br><strong>mismo</strong>"],"Open in a pop-up":[null,"Abrir en una ventana emergente"],"Download this track":[null,"Descargar esta pista"],"Download":[null,"Descargar"],"Share this track":[null,"Compartir esta pista"],"Share":[null,"Compartir"],"SHARE THIS TRACK":[null,"COMPARTIR ESTA PISTA"],"Share on Facebook":[null,"Compartir en Facebook"],"Share on Twitter":[null,"Compartir en Twitter"],"Share on Google Plus":[null,"Compartir en Google Plus"],"Code to embed":[null,"Cأ³digo para incrustar"],"Do you like this track?":[null,"آ؟Te gusta esta pista?"],"Error with player settings":[null,"Error con los ajustes del reproductor"],"The player has been successfully added. Reload the page to see the result.":[null,"El reproductor se ha aأ±adido correctamente. Recarga la pأ،gina para ver el resultado."],"To add your Player to this page, please provide the Player key (found in the Widgets section of your Radio Manager)":[null,"Para aأ±adir tu reproductor a esta pأ،gina, facilأ­tanos la clave del reproductor (que encontrarأ،s en la secciأ³n Widgets de tu Administrador de radios)"],"Your Player code:":[null,"El cأ³digo de tu reproductor:"],"Shout out":[null,"Enviar un saludo"],"Record":[null,"Grabar"],"Your web browser is not compatible with this widget":[null,"Tu navegador web no es compatible con este widget"],"Send your message!":[null,"آ،Envأ­a tu mensaje!"],"Your microphone is not detected, please press to try again":[null,"No se ha detectado tu micrأ³fono, por favor vuelve a intentarlo"],"You already sent a message less than 1 hour ago":[null,"Ya has enviado un mensaje hace menos de 1 hora"],"You can record up to 30 seconds":[null,"Puedes grabar hasta 30 segundos"],"Recording in progress":[null,"Grabaciأ³n en curso"],"Stop":[null,"Alto"],"Your record is ready":[null,"Tu grabaciأ³n estأ، lista"],"Pause":[null,"Pausa"],"Listen":[null,"Escuchar"],"My name or nickname":[null,"Mi nombre o nick"],"Send":[null,"Enviar"],"Send in progress...":[null,"Envأ­o en curso..."],"An error has occured, please try again later":[null,"Ha ocurrido un error, por favor vuelve a intentarlo"],"Record again":[null,"Volver a grabar"],"Your message was sent":[null,"Tu mensaje ha sido enviado"],"Thank you for your messsage.":[null,"Gracias por tu mensaje."],"Stay tuned!":[null,"آ،Mantente atento!"],"Close":[null,"Cerrar"],"Oops!":[null,"آ،Vaya!"],"It seems that we have not detected any sound in your record":[null,"Parece que no hemos detectado ningأ؛n sonido en tu grabaciأ³n"]};
dicts["fr"] = {"":{"project-id-version":"","pot-creation-date":"","po-revision-date":"","last-translator":"","language-team":"","language":"fr","mime-version":"1.0","content-type":"text/plain; charset=UTF-8","content-transfer-encoding":"8bit","x-generator":"Poedit 2.0.6","plural-forms":"nplurals=2; plural=(n > 1);","x-poedit-keywordslist":"translate_rk","x-poedit-basepath":"../player","x-poedit-sourcecharset":"UTF-8","x-poedit-searchpath-0":"."},"This radio has no any artist for the moment.":[null,"Cette radio nâ€™a aucun artiste pour le moment."],"Discover":[null,"Dأ©couvrir"],"on RadioKing":[null,"sur RadioKing"],"The field must contains between 4 and 60 characters":[null,"Le champ doit contenir entre 4 et 60 caractأ¨res"],"I'm listening \"{0}\" on {1}":[null,"Jâ€™أ©coute \"{0}\" en ce moment sur {1}"],"I'm listening \"{0}\" on {1}, {2}":[null,"Jâ€™أ©coute \"{0}\" en ce moment sur {1}, {2}"],"listener":[null,"auditeur"],"listeners":[null,"auditeurs"],"This radio doesn't have any tracks for now.":[null,"Cette radio nâ€™a aucun titre pour le moment."],"This radio has no any track for the moment.":[null,"Cette radio nâ€™a aucun titre pour le moment."],"Date":[null,"Date"],"Hour":[null,"Heure"],"Title":[null,"Titre"],"Buy":[null,"Acheter"],"<strong>Right</strong><br><strong>now</strong>":[null,"<strong>En</strong><br><strong>ce moment</strong>"],"Open in a pop-up":[null,"Ouvrir dans une pop-up"],"Download this track":[null,"Tأ©lأ©charger ce titre"],"Download":[null,"Tأ©lأ©charger"],"Share this track":[null,"Partager ce titre"],"Share":[null,"Partager"],"SHARE THIS TRACK":[null,"PARTAGER CE TITRE"],"Share on Facebook":[null,"Partager sur Facebook"],"Share on Twitter":[null,"Partager sur Twitter"],"Share on Google Plus":[null,"Partager sur Google Plus"],"Code to embed":[null,"Code أ  intأ©grer"],"Do you like this track?":[null,"Aimez-vous ce titre ?"],"Error with player settings":[null,"Erreur avec la configuration du player"],"The player has been successfully added. Reload the page to see the result.":[null,"Le player a bien أ©tأ© ajoutأ©. Rechargez la page pour voir le rأ©sultat."],"To add your Player to this page, please provide the Player key (found in the Widgets section of your Radio Manager)":[null,"Pour ajouter le Player sur cette page, merci de renseigner la clef du Player (fourni dans la partie Widgets de votre Manager Radio)."],"Your Player code:":[null,"Clأ© de votre Player :"],"Shout out":[null,"Dأ©dicace"],"Record":[null,"Enregistrer"],"Your web browser is not compatible with this widget":[null,"Votre navigateur n'est pas compatible avec ce widget"],"Send your message!":[null,"Envoyez votre message !"],"Your microphone is not detected, please press to try again":[null,"Votre micro n'est pas actif, appuyez أ  nouveau pour rأ©essayer"],"You already sent a message less than 1 hour ago":[null,"Vous avez dأ©jأ  envoyأ© un message il y a moins d'une heure"],"You can record up to 30 seconds":[null,"Vous pouvez enregistrer jusqu'أ  30 secondes"],"Recording in progress":[null,"Enregistrement en cours"],"Stop":[null,"Stop"],"Your record is ready":[null,"Votre enregistrement est prأھt"],"Pause":[null,"Pause"],"Listen":[null,"أ‰couter"],"My name or nickname":[null,"Mon nom ou pseudo"],"Send":[null,"Envoyer"],"Send in progress...":[null,"Envoi en cours..."],"An error has occured, please try again later":[null,"Erreur lors de l'envoi, veuillez rأ©essayer plus tard"],"Record again":[null,"Enregistrer أ  nouveau"],"Your message was sent":[null,"Votre message a أ©tأ© envoyأ©"],"Thank you for your messsage.":[null,"Merci pour votre message."],"Stay tuned!":[null,"Restez أ  l'أ©coute !"],"Close":[null,"Fermer"],"Oops!":[null,"Oups !"],"It seems that we have not detected any sound in your record":[null,"Nous n'avons dأ©tectأ© aucun son venant de votre micro"]};
dicts["it"] = {"":{"project-id-version":"","pot-creation-date":"","po-revision-date":"","last-translator":"","language-team":"","language":"it","mime-version":"1.0","content-type":"text/plain; charset=UTF-8","content-transfer-encoding":"8bit","x-generator":"Poedit 2.0.6","plural-forms":"nplurals=2; plural=(n != 1);"},"This radio has no any artist for the moment.":[null,"Al momento questa radio non ha alcun artista."],"Discover":[null,"Scopri"],"on RadioKing":[null,"su RadioKing"],"The field must contains between 4 and 60 characters":[null,"Il campo deve contenere un numero di caratteri compreso tra 4 e 60"],"I'm listening \"{0}\" on {1}":[null,"Sto ascoltando  \"{0}\" su {1}"],"I'm listening \"{0}\" on {1}, {2}":[null,"Sto  ascoltando \"{0}\" su {1}, {2}"],"listener":[null,"ascoltatore"],"listeners":[null,"ascoltatori"],"This radio doesn't have any tracks for now.":[null,"Al momento questa radio non ha alcun brano."],"This radio has no any track for the moment.":[null,"Al momento questa radio non ha alcun brano."],"Date":[null,"Data"],"Hour":[null,"Ora"],"Title":[null,"Titolo"],"Buy":[null,"Acquista"],"<strong>Right</strong><br><strong>now</strong>":[null,"<strong>Right</strong><br><strong>ora</strong>"],"Open in a pop-up":[null,"Apri in un pop-up"],"Download this track":[null,"Scarica questo brano"],"Download":[null,"Scarica"],"Share this track":[null,"Condividi questo brano"],"Share":[null,"Condividi"],"SHARE THIS TRACK":[null,"CONDIVIDI QUESTO BRANO"],"Share on Facebook":[null,"Condividi su Facebook"],"Share on Twitter":[null,"Condividi su Twitter"],"Share on Google Plus":[null,"Condividi su Google Plus"],"Code to embed":[null,"Codice da incorporare"],"Do you like this track?":[null,"Ti piace questo brano?"],"Error with player settings":[null,"Errore nelle impostazioni del lettore"],"The player has been successfully added. Reload the page to see the result.":[null,"Il lettore أ¨ stato aggiunto correttamente. Ricarica la pagina per vedere il risultato."],"To add your Player to this page, please provide the Player key (found in the Widgets section of your Radio Manager)":[null,"Per aggiungere il tuo Lettore a questa pagina, fornisci la chiave del Lettore (che si trova nella sezione Widget del tuo Gestore Radio)"],"Your Player code:":[null,"Il tuo codice Lettore:"],"Shout out":[null,"Annunciati"],"Record":[null,"Registra"],"Your web browser is not compatible with this widget":[null,"Il tuo browser web non أ¨ compatibile con questo widget"],"Send your message!":[null,"Invia il tuo messaggio!"],"Your microphone is not detected, please press to try again":[null,"Il tuo microfono non أ¨ stato rilevato, premi per riprovare"],"You already sent a message less than 1 hour ago":[null,"Hai giأ  inviato un messaggio meno di unâ€™ora fa"],"You can record up to 30 seconds":[null,"Puoi registrare fino a 30 secondi"],"Recording in progress":[null,"Registrazione in corso"],"Stop":[null,"Stop"],"Your record is ready":[null,"La tua registrazione أ¨ pronta"],"Pause":[null,"Pausa"],"Listen":[null,"Ascolta"],"My name or nickname":[null,"Il mio nome e il mio nickname"],"Send":[null,"Invia"],"Send in progress...":[null,"Invio in corso..."],"An error has occured, please try again later":[null,"Si أ¨ verificato un errore, ritenta piأ¹ tardi"],"Record again":[null,"Registra di nuovo"],"Your message was sent":[null,"Il tu messaggio أ¨ stato inviato"],"Thank you for your messsage.":[null,"Grazie per il tuo messaggio."],"Stay tuned!":[null,"Continua a seguirci!"],"Close":[null,"Chiudi"],"Oops!":[null,"Ops!"],"It seems that we have not detected any sound in your record":[null,"Non ci risulta la registrazione di alcun suono nella tua registrazione"]};
dicts["pt"] = {"":{"project-id-version":"","pot-creation-date":"","po-revision-date":"","last-translator":"","language-team":"","language":"pt","mime-version":"1.0","content-type":"text/plain; charset=UTF-8","content-transfer-encoding":"8bit","x-generator":"Poedit 2.0.6","plural-forms":"nplurals=2; plural=(n != 1);"},"This radio has no any artist for the moment.":[null,"Neste momento, esta rأ،dio nأ£o tem qualquer artista."],"Discover":[null,"Descobrir"],"on RadioKing":[null,"no RadioKing"],"The field must contains between 4 and 60 characters":[null,"O campo precisa conter entre 4 e 60 caracteres"],"I'm listening \"{0}\" on {1}":[null,"Estou a ouvir \"{0}\" em {1}"],"I'm listening \"{0}\" on {1}, {2}":[null,"Estou a ouvir \"{0}\" em {1}, {2}"],"listener":[null,"ouvinte"],"listeners":[null,"ouvintes"],"This radio doesn't have any tracks for now.":[null,"Neste momento, esta rأ،dio nأ£o tem quaisquer faixas."],"This radio has no any track for the moment.":[null,"Neste momento, esta rأ،dio nأ£o tem qualquer faixa."],"Date":[null,"Data"],"Hour":[null,"Hora"],"Title":[null,"Tأ­tulo"],"Buy":[null,"Comprar"],"<strong>Right</strong><br><strong>now</strong>":[null,"<strong>Agora</strong><br><strong>mesmo</strong>"],"Open in a pop-up":[null,"Abrir numa janela de pop-up"],"Download this track":[null,"Transferir esta faixa"],"Download":[null,"Transferir"],"Share this track":[null,"Partilhar esta faixa"],"Share":[null,"Partilhar"],"SHARE THIS TRACK":[null,"PARTILHAR ESTA FAIXA"],"Share on Facebook":[null,"Partilhar no Facebook"],"Share on Twitter":[null,"Partilhar no Twitter"],"Share on Google Plus":[null,"Partilhar no Google Plus"],"Code to embed":[null,"Cأ³digo para incorporar"],"Do you like this track?":[null,"Gosta desta faixa?"],"Error with player settings":[null,"Ocorreu um erro com as definiأ§أµes do leitor"],"The player has been successfully added. Reload the page to see the result.":[null,"O leitor foi adicionado com sucesso. Recarregue a pأ،gina para ver o resultado."],"To add your Player to this page, please provide the Player key (found in the Widgets section of your Radio Manager)":[null,"Para adicionar o Leitor a esta pأ،gina, forneأ§a a chave do Leitor (localizada na secأ§أ£o Widgets do Gestor de rأ،dio)"],"Your Player code:":[null,"O cأ³digo do Leitor:"],"Shout out":[null,"Gritar"],"Record":[null,"Gravar"],"Your web browser is not compatible with this widget":[null,"O seu web browser nأ£o أ© compatأ­vel com este widget"],"Send your message!":[null,"Envie a sua mensagem!"],"Your microphone is not detected, please press to try again":[null,"O seu microfone nأ£o foi detetado, por favor, pressione e tente de novo"],"You already sent a message less than 1 hour ago":[null,"Jأ، enviou uma mensagem hأ، menos de 1 hora"],"You can record up to 30 seconds":[null,"Pode gravar atأ© 30 segundos"],"Recording in progress":[null,"Gravaأ§أ£o em progresso"],"Stop":[null,"Pare"],"Your record is ready":[null,"A sua gravaأ§أ£o estأ، pronta"],"Pause":[null,"Pausa"],"Listen":[null,"Ouvir"],"My name or nickname":[null,"O meu nome ou alcunha"],"Send":[null,"Enviar"],"Send in progress...":[null,"Envio em progresso..."],"An error has occured, please try again later":[null,"Ocorreu um erro, por favor, tente de novo mais tarde"],"Record again":[null,"Gravar de novo"],"Your message was sent":[null,"A sua mensagem foi enviada"],"Thank you for your messsage.":[null,"Obrigado pela sua mensagem."],"Stay tuned!":[null,"Fique ligado!"],"Close":[null,"Fechar"],"Oops!":[null,"Oops!"],"It seems that we have not detected any sound in your record":[null,"Parece que nأ£o detetأ،mos nenhum som na sua gravaأ§أ£o"]};
if (!String.prototype.format) {
  String.prototype.format = function() {
    var args = arguments;
    return this.replace(/{(\d+)}/g, function(match, number) {
      return typeof args[number] != 'undefined'
        ? args[number]
        : match
      ;
    });
  };
}

function translate_rk(term, lang) {
    if(!lang)
        lang = (navigator.language || navigator.userLanguage || 'en').substr(0, 2).toLowerCase();

    // return translated term or term if no dict is available
    if(dicts[lang] && dicts[lang][term] && dicts[lang][term][1] != '')
        return dicts[lang][term][1];

    return term;
}

$(document).ready(function() {
	var usedMemLimit = true;
	var usedMemLimitVal = 500;

	var pochetteWidth = 248;
	var pochetteHeight = 248;

	var radioInfoInterval = null;
    var listenersInterval = null;

	if ($typeplayer == "big") {
		pochetteWidth = 194;
		pochetteHeight = 194;
	}

	var pochetteUrl = "images/legacy/cover.png";

	if (coverimg) {
		pochetteUrl = coverimg;
	}

	$('#pochette').append('<img src="' + pochetteUrl + '"></img>');

	$('#artiste').text(radioName);
	$('#titre').text("");

	$('#nomRadio').text(radioName);

	var mobileStream, defaultStream, hdStream;
	for (var i = 0; i < streams.length; i++) {
		switch (streams[i].type) {
			case 1:
				defaultStream = streams[i];
				break;
			case 2:
				if (streams[i].status === 'active') {
					mobileStream = streams[i];

					if (isMobile()) {
						setTimeout(function() {
							$('#hd-button').show();
						});
					}
				}
				break;
			case 3:
				if (streams[i].status === 'active') {
					hdStream = streams[i]
					setTimeout(function() {
						$('#hd-button').show();
					});
				}
				break;
		}
	}

	var stream;
	var resultContainer = $('#pochette');
	var goDown = true;
	var songMem = new Array();
	var saveFirstSong = true;
	var historyIS = false;
	var musicLink;
	var currentSong;
	var artistSong;
	var titleSong;
	var errorTitle = 0;
	var isStart = false;
	var volumeStream = 75;
	var radioInfoInterval = undefined;
	var tries = 0;
	var hd = false;

	///////////////////////////////

	$("#radioStream").jPlayer({
		swfPath: "/widgets/player/js/jquery.jplayer.swf",
		supplied: "mp3",
		autohide: false,
		solution: "html,flash",
		volume: $("#volume").text() / 100,
		ready: function() {
			if (AutoPlay == "1" && !isMobile()) {
				startRadio();
			}
		},
		error: function(e) {
			// 3 tries if error on mobile
			if (e.jPlayer.error.type === 'e_url' && tries++ < 3)
				stream.jPlayer('play');
		}
	});

	stream = $("#radioStream");
	stream.bind($.jPlayer.event.pause, function(event) {
		stopPlayer();
	});
	stream.bind($.jPlayer.event.playing, function(event) {
		playPlayer();
	});

	// Player start Volume 75
	$("#volume").text(75);
	$("#volume").hide();
	$("#stopBtn").hide();
	$('#slider').slider({
		orientation: "horizontal",
		range: "min",
		min: 0,
		max: 100,
		step: 5,
		value: 75,
		slide: function(event, ui) {
			if (volumeStream != ui.value) {
				volumeStream = ui.value;
				if(!$("#mute-button").hasClass("muted"))
					stream.jPlayer("volume", ui.value / 100);
				$("#volume").text(ui.value);
			}
		}
	});

	var cookie = readCookie('player_hd');
	if (cookie === 'active' || (!cookie && !isMobile())) {
		hd = true;
		$('.hd').addClass('on');
		$('.hd').removeClass('off');
	}

	function getStreamLink() {
		var url = $urlflux + '/';

		if (hd && hdStream)
			url += hdStream.idstream;
		else if (hd && isMobile() && !hdStream && mobileStream)
			url = $urlflux;
		else if (isMobile() && mobileStream)
			url += mobileStream.idstream;
		else
			url = $urlflux;

		return url;
	}

	function startRadio() {
		window.addEventListener("unhandledrejection", function(err) {
			if (err.reason.name == 'NotAllowedError')
				stopPlayer();
		});

		showLoader();
		stream.jPlayer("setMedia", {
			mp3: getStreamLink()
		});

		stream.jPlayer('play');

		clearInterval(radioInfoInterval);
		getTitrage(true);
		radioInfoInterval = setInterval(
		function() {
			getTitrage(true)
		}, 20000);
	}

	// Player Stop Button
	$("#btnStop").click(function() {
		stream.jPlayer('clearMedia');
		clearInterval(radioInfoInterval);
		radioInfoInterval = setInterval(getTitrage, 20000);
		getTitrage();
		songMem = null;
		stream.jPlayer('pause');
		stopPlayer();
	})

	$("#btnPlay").click(function() {
		startRadio();
	})

	function playPlayer() {
		$("#btnStop").css('display', 'inline-block');
		$("#btnPlay").hide();
		$('#loading').hide();
	}

	function showLoader() {
		$("#btnStop").hide();
		$("#btnPlay").hide();
		$('#loading').css('display', 'inline-block');
	}

	function stopPlayer() {
		$("#btnStop").css('display', 'none');
		$('#loading').css('display', 'none');
		$("#btnPlay").css('display', 'inline-block');
		$('#pochette').empty();
		$('#pochette').append('<img src="' + pochetteUrl + '"></img>');

		if ($itunes != 0) {
			$('#btnDownload').attr('href', "javascript:void(0)");
			$('#btnDownload').css('cursor', 'default');
		}

		/* SHARE PANEL */
		if ($partage != 0) {
			$('#linkTwitter').attr('href', "javascript:void(0)");
			$('#linkGoogle').attr('href', "javascript:void(0)");
		}
	}

	function getTitrage(playing) {

		$.ajax({
			url: apiURL + '/radio/' + $idradio + '/track/current',
			timeout: 10000,
			success: function(data) {
				var track = data;

				if (track.title == "" || track.title == "null" || track.title == null) {
					$('#artiste').text(radioName);
					errorTitle += 1;

					if (errorTitle > 3) {
						clearInterval(radioInfoInterval);

					}
					return;

				} else {
					errorTitle = 0;
				}

				$('#titrage').hide();

				currentSong = track.artist + ' - ' + track.title + playing;
				artistSong = track.artist;
				titleSong = track.title;

				var urlcover = "/widgets/player/images/legacy/cover.png";

				if (track.cover) {
					urlcover = track.cover;
				} else {
					urlcover = pochetteUrl;
				}

				$('#artiste').text(artistSong);
				$('#titre').text(titleSong);

				$('#titrage').css('display', 'inline-block');

				if (currentSong != songMem) {
					songMem = currentSong;

					if($partage != 0 && currentSong != '') {
						$('#linkTwitter').attr('href', 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(translate_rk('I\'m listening "{0}" on {1}, ', lang).format(artistSong + ' - ' + titleSong, radioName)) + '&url=' + $radiourl);
					}

					if ($itunes != 0) {
						if (track.buy_link && track.buy_link != "null") {
							$('#btnDownload').removeClass("dldisabled");
							$('#btnDownload').attr('href', track.buy_link);
							$('#btnDownload').css('cursor', 'pointer');
						} else {
							$('#btnDownload').addClass("dldisabled");
							$('#btnDownload').attr('href', "javascript:void(0)");
							$('#btnDownload').css('cursor', 'default');
						}
					}


					if (playing == true && urlcover !== null && $pochette != "0") {

						resultContainer.empty();
						resultContainer.hide();

						var curCover = '<img src="' + urlcover + '" />';

						resultContainer.append(curCover);
						resultContainer.css('display', 'inline-block');
					}
				}
			},
			dataType: 'json'
		});

		checkVoteStatus();

		return false;
	}

    function getListeners() {
        $.ajax({
            url: apiURL + '/radio/' + $idradio + '/listener/count',
            timeout: 10000,
            dataType: 'json',
            success: function(data) {
                $('#listeners-count').show();
                $('#listeners-count span.listeners-count').text(data.listener_count);
                if($typeplayer == 'h') {
                    $('#radio-title').css('max-width', 'calc(100% - ' + (70 + data.listener_count.toString().length * 10) + 'px)');
                }
                else {
                    $('#listeners-count span.listeners-count').append(' ' + (data.listener_count > 1 ? translate_rk('listeners', lang) : translate_rk('listener', lang)));
                }
            },
            error: function(e) {
                $('#listeners-count').hide();
                if(e.status == 401) {
                    clearInterval(listenersInterval);
                }
            }
        });
    }

	function strpos(haystack, needle, offset) {
		var i = (haystack + '').indexOf(needle, (offset || 0));
		return i === -1 ?
			false :
			i;
	}

	$("#btnPopup").click(function() {
		openPopup();
	})

	function openPopup() {
		popupWindows = window.open(document.URL + "&a=" + (stream.data().jPlayer.status.paused ? '0' : '1'), 'popupplayer', 'width=' + $taillePlayerW + ',height=' + $taillePlayerH + ',left=' + (Math.round((screen.width - $taillePlayerW) / 2)) + ',top=' + (Math.round((screen.height - $taillePlayerH) / 2)) + ',scrollbars=no,location=no,menubar=no, resizable=no, toolbar=no');
		popupWindows.focus();
		stream.jPlayer('clearMedia');
		if (radioInfoInterval !== undefined) {
			clearInterval(radioInfoInterval);
		}
		songMem = null;
		stream.jPlayer('pause');
		stopPlayer();

		return false;
	}

	$("#mute-button").on('click', function() {
		if($(this).hasClass('muted')) {
			$(this).removeClass('muted');
			stream.jPlayer("volume", parseInt($("#volume").text()) / 100);
		}
		else {
			$(this).addClass('muted');
			stream.jPlayer("volume", 0);
		}
	});

	$('.hd').click(function() {
		if (!hdStream && !mobileStream)
			return;

		if (hd) {
			hd = false;
			$('.hd').addClass('off');
			$('.hd').removeClass('on');
			startRadio();
		} else {
			hd = true;
			$('.hd').addClass('on');
			$('.hd').removeClass('off');
			startRadio();
		}

		createCookie('player_hd', hd ? 'active' : 'inactive', 30);
	});

	function isMobile() {
		var check = false;
		(function(a) {
			if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4)))
				check = true;
		})(navigator.userAgent || navigator.vendor || window.opera);
		return check;
	}

	$("#share-button").click(function() {
		if(!$(this).hasClass("activated")) {
			$("#share-button").addClass("activated");
			$("#share-zone").css("display", "block");
			$("#close-share").css("display", "block");
			$(".section").css("display", "none");
			$("#cover-fade").css("display", "none");
			$("#like-zone").addClass("disable");

			setTimeout(function() {
				$("#share-zone").css("opacity", "1");
				$("#close-share").css("opacity", "1");
			}, 10);
		}
		else {
			$("#close-share").trigger("click");
		}

	});

	$("#close-share, #close-share svg").click(function() {
		$("#share-button").removeClass("activated");
		$("#share-zone").css("opacity", "0");
		$("#close-share").css("opacity", "0");
		$("#cover-fade").css("display", "block");
		$(".section").css("display", "block");
		$("#like-zone").removeClass("disable");

		setTimeout(function() {
			$("#share-zone").css("display", "none");
			$("#close-share").css("display", "none");
			$("#cover-fade").css("display", "block");
		}, 300);
	});

	getTitrage();
	radioInfoInterval = setInterval(getTitrage, 20000);

    if($plc == 1)آ {
        getListeners();
        listenersInterval = setInterval(getListeners, 20000);
    }

	function disableVote() {
		$("#like-button").addClass('voteDisabled');
		$("#dislike-button").addClass('voteDisabled');
	}

	function enableVote() {
		$("#like-button").removeClass('voteDisabled');
		$("#dislike-button").removeClass('voteDisabled');
	}

	function generateTrackId(data) {
		return data.id + (data.is_live ? '_l' : '');
	}

	function hasVoted(data) {
		var d = new Date(); // 2 heures
		var timestamp = d.getTime();
		var id = generateTrackId(data);

		document.cookie = $idradio + "trackvoteid=" + id;
		document.cookie = $idradio + "trackvotets=" + timestamp;

        // Gestion de l'expiration
		d.setTime(+ d + 7200000); // dأ©finition de la date d'expiration
		document.cookie = "expires=" + d.toGMTString();
		document.cookie = "path=/player/";
		document.cookie = "max-age=7200000";
		disableVote();
	}

	function voteTrack(score, trackdata) {
		disableVote();

		score = (score > 0) ? 1 : -1;

		responseData = {
			vote: score
		}

		$.ajax({
			url: managerApiURL + '/radio/' + $idradio + '/track/vote',
			timeout: 10000,
			type: 'POST',
			data: JSON.stringify(responseData),
			dataType: 'json',
			success: function(data, status, xhr) {
				hasVoted(trackdata);
			},
			error: function(xhr, textStatus, error) {
				if(xhr.status == 429) {
					hasVoted(trackdata);
				}
				disableVote();
			}
		});
	}

	function checkVoteStatus(score) {

		$.ajax({
			url: apiURL + '/radio/' + $idradio + '/track/current',
			timeout: 10000,
			success: function(data) {
				var d = new Date();

				var cookiets = new Number(getCookie($idradio + 'trackvotets')); // Number car int trop petit...
				var expired = (d.getTime() - cookiets) > 7200000; // 60 * 60 * 2 * 1000


				if((data.is_live && data.forced_title) || !data.id || ((getCookie($idradio + 'trackvoteid') == generateTrackId(data)) && !expired)) {
					disableVote();
				}
				else {
					enableVote();
					if(score) {
						voteTrack(score, data);
					}
				}
			},
			dataType: 'json'
		});
	}

	$("#like-button").on('click', function() {
		if($(this).hasClass("voteDisabled")) return;
		checkVoteStatus(1);
	});

	$("#dislike-button").on('click', function() {
		if($(this).hasClass("voteDisabled")) return;
		checkVoteStatus(-1);
	});

	function getCookie(cname) {
		var name = cname + "=";
		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
		for(var i = 0; i <ca.length; i++) {
			var c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
});

function createCookie(name, value, days) {
	if (days) {
		var date = new Date();
		date.setTime(date.getTime() + (720000));
		var expires = "; expires=" + date.toGMTString();
	} else var expires = "";
	document.cookie = name + "=" + value + expires + "; path=/player";
}

function readCookie(name) {
	var nameEQ = name + "=";
	var ca = document.cookie.split(';');
	for (var i = 0; i < ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0) == ' ') c = c.substring(1, c.length);
		if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
	}
	return null;
}
